# JS_study > 함수
## 1. 함수지향

### 1. 유효범위(Scope)

#### #1.1 전역변수와 지역변수

* 변수의 수명을 의미.

~~~ javascript
var vscope = 'global'; // 함수 밖에 선언된 변수.
function fscope(){
var vscope = 'local';
alert(vscope);
}
fscope(); // local
~~~
  > fscope 함수 안에 vscope 변수 선언. alert(vscope);명령어가 가장 가까운 변수를 찾는다. 그러므로 local이 나옴.
  >
  > * 지역변수 = local :: 함수 {} 안쪽에서만 접근 할 수 있는 변수.

  >* 전역변수 = global :: 전체적으로 접근할 수 있는 변수.



~~~ javascript
var vscope = 'global'; // 전역변수(global)
function fscope(){
alert(vscope);
}
function fscope2(){
alert(vscope);
}
fscope(); // global
fscope2(); // global
~~~

>* `fscope()`, `scope2()` 함수가 전역변수인 `vscope`를 모두 가르킴으로 전역변수이다.



~~~ javascript
var vscope = 'global';
function fscope(){
    var vsope = 'local';
    var lv = 'local variables';
    alert(lv); // local variables
}
fscope();
alert(vl); // Error
~~~

>* `scope()`안에 만들어진 변수 lv는 지역변수이고, 지역변수는 그 함수내에서만 쓸 수 있다.



~~~ javascript
var vscope = 'global';
function fscope(){
    var vscope = 'local';
}
fscope();
alert(vscope); // global
~~~
> * **로컬변수를 만들때 `var` 변수를 만든다.**
> * `fscope()` 함수 내에 `var vscope` 변수를 선언했더라도 `alert(vscope);`는 전체적인 어플리케이션에서 `vscope`를 찾는다.
> * `global`(전역변수) 출력.



~~~ javascript
var vscope = 'global';
function fscope(){
    vscope = 'local';
}
fscope();
alert(vscope); // local
~~~

> * `var` 빼면 로컬이 아닌 **전역변수**를 의미. 
> * `vscope = 'local';` 은 지역변수가 아니라 전역변수로 들어간다.
> * `alert(vscope);`는 `global`이 아닌 `fscope()`함수 안에 있는 `'local'` 로 출력.



~~~ javascript
var vscope = 'global';
function fscope(){
	var vscope = 'local_1';
    vscope = 'local_2';
}
fscope();
alert(vscope); // global
~~~

> * `fscope()`안에 이미 지역변수 생성.(`var vscope = 'local'`)
>
> * 4줄 `vscope`는 지역변수를 가리킴(3줄)
>
>   * 이미 지역변수가 생성된 변수에서 `vscope`는 지역변수값으로 할당.
>
>   * ~~~ javascript
>     // 정리
>      var vscope = 'global';
>      function fscope(){
>     var vscope = 'local_2';
>      }
>      fscope();
>      alert(vscope); // global
>     ~~~
>   ~~~
>   
>   ~~~
> ~~~
> 
> ~~~


* 정리
  * 이미 `var vscope = 'local';` 지역변수가 생성된 `vscope`변수는 `vscope`를 할당했을 때 `var`를 가 없더라도 우선적으로 로컬변수를 확인한다.
  * 로켤변수가 없다면(`vscope = 'local';`) 전연변수(`var vscope = 'global';`) 사용.
  * 지역변수가 있다면(`var vscope = 'local';`) 지역변수(`local`)를 가리키게 된다.
    * 그러므로 `alert(vscope)`는 전체적으로 `vscope`의 할당된 값을 찾는데 전역변수(`global`)를 출력하게 된다.



* 전역변수와 지역변수를 왜 사용할까?
  * 함수내에 선언한 변수는 함수 안에서만 사용가능함으로, 전역변수보다는 지역변수를 쓰는 것이 유용하다.
  * 전역변수보다는 지역변수를 쓰는 것이 좋다.
  * var를 함수 밖에서 쓰면 전역변수가 된다.
  * 함수 안에서 var를 쓰면 그 함수 안에서 쓸 수 있는 지역변수가 된다.
  * 변수를 선언할 때는 var를 쓰는 것이 좋다.

----



#### #1-2 유효범위의 효용

~~~ javascript
function a(){
    var i = 0;
}
for(var i = 0; i < 5; i++){
   a();
    console.log(i); // 0 1 2 3 4
}
~~~

~~~ javascript
function a(){
    i = 0;
}
for(var i = 0; i < 5; i++){
   a();
    console.log(i);
}
~~~

> * 브라우저가 다운됨.
> * for문 안에 있는 변수 i의 값은 어떤 함수에 소속되어 있지 않다. 그러므로 i는 전역변수.
> * for문 안에 a함수를 호출하게 되면 a안에 있는 i 변수는 전역변수가 되어 for문 i와 a함수 i의 변수가 같기 때문에 for문의 i는 a()함수가 실행되어 계속 0 실행 => 무한반복.
> * 왜 그럴까? 
>   * 같은 이름의 변수i라는 중복했지만 각각의 취지가 다를때 문제가 생김. 코드가 복잡하거나 많은 양의 코드이면 문제 찾기 힘들다. => 해소하기 위해 만든 지역변수, 전역변수 즉 유효범위가 필요하다.
>



____



#### #1-3 전역변수의 사용

~~~ javascript
var MYAPP = {} // MYAPP 전역변수로 만든다.
MYAPP.calculator = { // 객체 안에 있는 변수 : 속성(calculator)
    'left' : null,
    'right' : null
}
MYAPP.coordinate = {
    'left' : null,
    'right' : null
}
 
MYAPP.calculator.left = 10;
MYAPP.calculator.right = 20;
function sum(){
    return MYAPP.calculator.left + MYAPP.calculator.right;
}
document.write(sum());
~~~

> * 불가피하게 전역변수를 사용해야 하는 경우 하나의 객체를 전역변수로 만들고 객체의 속성으로 변수를 관리한다.

~~~ javascript
(function(){
    var MYAPP = {} // 전역변수가 아닌 위 함수의 지역변수가 된다.
    MYAPP.calculator = {
        'left' : null,
        'right' : null
    }
    MYAPP.coordinate = {
        'left' : null,
        'right' : null
    }

    MYAPP.calculator.left = 10;
    MYAPP.calculator.right = 20;
    function sum(){
        return MYAPP.calculator.left + MYAPP.calculator.right;
    }
    document.write(sum());
}())
~~~

> * 전역변수를 사용하고 싶지 않다면 익명함수를 호출해 자기호출함수를 만든다.
> * 자바스크립트에서 로직을 모듈화하는 일반적인 방법.



* 즉시 실행 함수 사용법

  * 기명 즉시 실행 함수

  * ~~~ javascript
    (function square(x){
        console.log(x * x);
    })(2);
    (function square(x){
        console.log(x * x);
    }(2));
    ~~~

    * 괄호의 위치가 다를 뿐 같은 기능 수행.

  * 익명 즉시 실행 함수

  * ~~~ javascript
    (function(x){
        console.log(x * x);
    })(2);
    (function(x){
        console.log(x * x);
    }(2));
    ~~~

    

* 즉시 실행 함수를 사용하는 이유

  * 초기화

    * 즉시 실행 함수는 한 번의 실행만 필요로 하는 초기화 코드 부분에 많이 사용.
    * 이는 변수를 전역(global scope)으로 선언하는 것을 피하기 위해서이다.
    * 전역에 변수를 추가하지 않아도 되기 때문에 코드 충돌을 피할 수 있어 플러그인이나 라이브러리 등을 만들 때 많이 사용.

  * 라이브러리 전역 변수의 충돌

    * jQuery나 Prototype 라이브러리는 동일한 $라는 전역변수를 사용. 만약 이 두개의 라이브러리를 같이 사용한다면 $ 변수 충돌이 일어남.

    * 즉시 실행 함수를 사용하여 $ 전역변수의 충돌을 피할 수 있다.

      ~~~ javascript
      (function($){
          // $는 jQuery Object
      })(jQuery);
      ~~~

      > * 즉시 실행 함수 안에서 $는 전역변수가 아닌 jQuery Object의 지역변수가 되어 Prototype라이브러리의 $ 충돌 없이 사용 가능하다.



[Link]:<https://beomy.tistory.com/9>	"즉시실행함수"



---



#### #1.4 유효범위의 대상(함수)

* **자바스크립트의 지역변수는 함수에서만 유효.**

* 함수의 중괄호 안에서만 유효범위를 제공하고 반복문, 조건문 등의 중괄호안의 변수는 지역변수로서의 의미가 아니다.

  * ~~~javascript
    for(var i = 0; i < 1; i++){
        var name = 'coding every body';
    }
    alert(name); // coding every body
    ~~~

  * ~~~ javascript
    function myFunction(){
        var name = 'codeing every body';
    }
    myFunction();
    alert(name); // undefined
    ~~~



-----



#### #1.5 정적 유효범위

* 자바스크립트는 함수가 선언된 시점에서의 유효범위를 갖는다.

* 유효범위의 방식을 정적 유효범위(static scoping) 혹은 렉시컬(lexical scoping)이라고 한다.

* 후에 클로저(closure)와 연관.

* ~~~ javascript
  var i = 5; // 전역변수
  
  function a(){
      var i = 10; // 지역변수
      b();
  }
  
  function b(){
      document.write(i); // i의 실행결과는?
  }
  a();
  ~~~

>* `document.write(i)`는 누구것인가? 
>  * `b()`안의 `document.write(i)`는 지역변수를 찾게되는데 지역변수가 없으므로 전역변수를 찾는다.
>  * 1. `b()`를 호출하고 있는 함수는 `a()`의 10값인지 => 사용
>    2. `b()`가 정의된 시점으로 볼 때 `i`값이 5인지 => 정의
>    3. 답은 2. 함수 b가 호출된 시점에서 b가 담겨져 있는 함수의 지역변수가 사용된 것이 아니다.
>* 사용될 때가 아니고 **정의 될때** 전역변수가 사용되게 된다.
>* b의 메소드가 정의되는 시점의 변수를 보면 누가 사용하던 똑같은 결과를 나타낸다. => **렉시컬**



~~~ javascript
var i = 5;
function a(){
    var i = 10;
    function b(){
		document.write(i); // 10
    }
    b();
}
a();
~~~

>* 함수 b의 i값을 함수 a에서 찾았으므로 (`var i = 10;`) 값은 10



~~~ javascript
var i = 5;
function a(){
    var i = 10;
    (function(){
        document.write(i);
    })();
}
a();
~~~

> * 즉시실행함수를 실행했으므로 값은 10
